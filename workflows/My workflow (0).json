{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "formTitle": "Upload KB Files",
        "formFields": {
          "values": [
            {
              "fieldLabel": "files",
              "fieldType": "file",
              "acceptFileTypes": ".txt",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        16,
        -48
      ],
      "id": "7f3055e9-8dda-431e-bb07-09e252a9cdcf",
      "name": "On form submission",
      "webhookId": "d7462b16-c8bd-4f4b-aaf3-12dc740dbc6b"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "vectors",
          "mode": "list",
          "cachedResultName": "vectors"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        240,
        -48
      ],
      "id": "8dc4ab19-6508-48b0-9d95-467ac540cd30",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "INwuqp5vSO0C6nVY",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        464,
        144
      ],
      "id": "d075eab6-95d1-4793-b9d8-1efbd0263531",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        576,
        384
      ],
      "id": "7eb4268f-2732-4cc8-90ae-29ef03bf862d",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "Q8rSHPWpEkDTZluJ",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        720,
        -48
      ],
      "id": "da8f679b-62de-4a58-8587-93b0643d736d",
      "name": "When chat message received",
      "webhookId": "3cda2831-0339-487c-9a47-ff8b2e9c9ca5"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=You are a helpful and reliable health information assistant.\n\nYour task is to help users with questions related to health, symptoms, diseases, conditions, treatments, and general well-being.\n\nYou must follow this order of information retrieval:\n\n1. First, use the Vector Search Tool to retrieve relevant information from embedded documents. If the results provide sufficient, accurate, and contextually appropriate information, use them to answer the user's query.\n\n2. If the vector search returns no useful results or lacks context to confidently answer the question, then use the Web Search Tool to look up reliable and current sources online (e.g., Mayo Clinic, WHO, CDC, NHS, etc.).\n\n3. If both Vector Search and Web Search fail to provide relevant information, fall back to your internal knowledge base to answer the query, making it clear that the response is based on general knowledge and not personalized advice.\n\nMake sure all your responses are:\n- Clear and easy to understand\n- Factually accurate\n- Free from medical diagnosis or treatment recommendations\n- Always encourage users to consult a qualified healthcare professional for personalized medical advice\n\nDo not make assumptions or fabricate information. When in doubt, say that more information is needed or suggest seeing a healthcare provider.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        928,
        -48
      ],
      "id": "7bf17076-8da0-4065-9d7c-b763c7b1ac34",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        768,
        144
      ],
      "id": "f75f44cd-1988-4058-b8da-bbdcd59ec2df",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "Q8rSHPWpEkDTZluJ",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        944,
        144
      ],
      "id": "847a027b-9cfb-4a09-a320-fbb82d3f0b00",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use this tool as the knowledge base for answering user queries.",
        "tableName": {
          "__rl": true,
          "value": "vectors",
          "mode": "list",
          "cachedResultName": "vectors"
        },
        "topK": 10,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1120,
        160
      ],
      "id": "f23add28-227c-4c98-80e5-420ac1228ef1",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "INwuqp5vSO0C6nVY",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "On form submission": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d01091c5-1de0-463e-810b-e415ffb220ff",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "12f1173664b60501f4f95f9d3cbaf2cab628c095c3e3447b93ff23d2dd00d9e9"
  },
  "id": "6acRpQS2qN9KA7d3",
  "tags": []
}